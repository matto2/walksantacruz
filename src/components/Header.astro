---
// Header Navigation Component
import Logo2 from './Logo2.astro';
import { tours } from '../data/tours';
const currentPath = Astro.url.pathname;
---

<header class="border-b border-border bg-background sticky top-0 z-40 backdrop-blur-sm bg-background/95">
	<nav class="container py-4">
		<div class="flex items-center justify-between">
			<!-- Logo/Brand -->
			<a href="/" class="hover:opacity-80 transition-opacity">
				<Logo2 />
			</a>

			<!-- Mobile Menu Button -->
			<button id="mobile-menu-button" class="md:hidden flex items-center gap-2" aria-label="Toggle menu">
				<span class="font-medium">Menu</span>
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<line x1="4" x2="20" y1="12" y2="12"></line>
					<line x1="4" x2="20" y1="6" y2="6"></line>
					<line x1="4" x2="20" y1="18" y2="18"></line>
				</svg>
			</button>

			<!-- Desktop Navigation -->
			<div class="hidden md:flex items-center gap-8">
				<a href="/" class={`text-foreground hover:text-primary transition-colors font-medium pb-1 border-b-[3px] ${currentPath === '/' ? 'font-bold border-primary' : 'border-transparent'}`}>
					Home
				</a>

				<!-- Tours Dropdown -->
				<div class="relative group">
					<button class="text-foreground hover:text-primary transition-colors font-medium pb-1 border-b-[3px] border-transparent flex items-center gap-1">
						Tours
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-180">
							<path d="m6 9 6 6 6-6"/>
						</svg>
					</button>
					<div class="absolute top-full left-0 mt-2 w-64 bg-background border border-border rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
						<div class="py-2">
							{tours.map((tour) => (
								<a
									href={`/tours/${tour.slug}`}
									class={`block px-4 py-2 text-foreground hover:bg-muted hover:text-primary transition-colors ${currentPath === `/tours/${tour.slug}` ? 'font-bold text-primary' : ''}`}
								>
									{tour.title}
								</a>
							))}
						</div>
					</div>
				</div>

				<a href="/gallery" class={`text-foreground hover:text-primary transition-colors font-medium pb-1 border-b-[3px] ${currentPath === '/gallery' ? 'font-bold border-primary' : 'border-transparent'}`}>
					Gallery
				</a>
				<a href="/about" class={`text-foreground hover:text-primary transition-colors font-medium pb-1 border-b-[3px] ${currentPath === '/about' ? 'font-bold border-primary' : 'border-transparent'}`}>
					About
				</a>
				<a href="/contact" class={`text-foreground hover:text-primary transition-colors font-medium pb-1 border-b-[3px] ${currentPath === '/contact' ? 'font-bold border-primary' : 'border-transparent'}`}>
					Contact
				</a>
				<!-- FareHarbor book button -->
				<a href="https://fareharbor.com/embeds/book/walksantacruz/?full-items=yes" class="btn">Book online now!</a>
				<!-- Stripe (disabled): <a href="https://buy.stripe.com/5kQ00j3Kxa6P3VSgnZ1ck0j" class="btn">Book Tour</a> -->
			</div>
		</div>

		<!-- Mobile Navigation -->
		<div id="mobile-menu" class="hidden md:hidden mt-4 pt-4 border-t border-border">
			<div class="flex flex-col gap-4">
				<a href="/" class={`text-foreground hover:text-primary transition-colors font-medium ${currentPath === '/' ? 'font-bold' : ''}`}>
					Home
				</a>

				<!-- Tours Dropdown Mobile -->
				<div>
					<button id="mobile-tours-toggle" class="text-foreground hover:text-primary transition-colors font-medium flex items-center gap-1 w-full">
						Tours
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform" id="mobile-tours-arrow">
							<path d="m6 9 6 6 6-6"/>
						</svg>
					</button>
					<div id="mobile-tours-dropdown" class="hidden pl-4 mt-2 flex flex-col gap-2">
						{tours.map((tour) => (
							<a
								href={`/tours/${tour.slug}`}
								class={`text-foreground hover:text-primary transition-colors ${currentPath === `/tours/${tour.slug}` ? 'font-bold text-primary' : ''}`}
							>
								{tour.title}
							</a>
						))}
					</div>
				</div>

				<a href="/gallery" class={`text-foreground hover:text-primary transition-colors font-medium ${currentPath === '/gallery' ? 'font-bold' : ''}`}>
					Gallery
				</a>
				<a href="/about" class={`text-foreground hover:text-primary transition-colors font-medium ${currentPath === '/about' ? 'font-bold' : ''}`}>
					About
				</a>
				<a href="/contact" class={`text-foreground hover:text-primary transition-colors font-medium ${currentPath === '/contact' ? 'font-bold' : ''}`}>
					Contact
				</a>
				<!-- FareHarbor book button -->
				<a href="https://fareharbor.com/embeds/book/walksantacruz/?full-items=yes" class="btn w-full">Book online now!</a>
				<!-- Stripe (disabled): <a href="https://buy.stripe.com/5kQ00j3Kxa6P3VSgnZ1ck0j" class="btn w-full">Book Tour</a> -->
			</div>
		</div>
	</nav>
</header>

<script is:inline>
	function setupMobileMenu() {
		const menuButton = document.getElementById('mobile-menu-button');
		const mobileMenu = document.getElementById('mobile-menu');

		if (!menuButton || !mobileMenu) return;

		// Remove old listeners by cloning
		const newMenuButton = menuButton.cloneNode(true);
		menuButton.parentNode.replaceChild(newMenuButton, menuButton);

		newMenuButton.addEventListener('click', (e) => {
			e.preventDefault();
			mobileMenu.classList.toggle('hidden');
		});

		// Get fresh references to tours dropdown elements after DOM is ready
		const toursToggle = document.getElementById('mobile-tours-toggle');
		const toursDropdown = document.getElementById('mobile-tours-dropdown');

		// Setup tours dropdown toggle
		if (toursToggle && toursDropdown) {
			// Remove old listener by cloning
			const newToursToggle = toursToggle.cloneNode(true);
			toursToggle.parentNode.replaceChild(newToursToggle, toursToggle);

			newToursToggle.addEventListener('click', (e) => {
				e.preventDefault();
				e.stopPropagation();
				// Get fresh reference to arrow after cloning
				const arrow = document.getElementById('mobile-tours-arrow');
				toursDropdown.classList.toggle('hidden');
				if (arrow) arrow.classList.toggle('rotate-180');
			});
		}

		// Close mobile menu when clicking a link (but not the tours toggle button)
		const mobileLinks = mobileMenu.querySelectorAll('a');
		mobileLinks.forEach(link => {
			link.addEventListener('click', () => {
				mobileMenu.classList.add('hidden');
				const dropdown = document.getElementById('mobile-tours-dropdown');
				const arrow = document.getElementById('mobile-tours-arrow');
				if (dropdown) dropdown.classList.add('hidden');
				if (arrow) arrow.classList.remove('rotate-180');
			});
		});
	}

	// Run on initial load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', setupMobileMenu);
	} else {
		setupMobileMenu();
	}

	// Re-run after view transitions
	document.addEventListener('astro:page-load', setupMobileMenu);
</script>
